<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hjhotelback.mapper.reservation.ReservationMapper">

    <!-- 관리자 예약목록 조회 -->
    <select id="getReservationList" resultType="ResReservation.List">
        select * from reservation
    <select/>

    <!-- 사용자/관리자 예약상세 조회 -->
    <select id="getReservationById" resultType="ResReservation">
        select * from reservation where reservation_id=#{ReservationId}
    <select/>

    <!-- 사용자 예약 생성 -->
    <insert id="createReservation" resultType="ResReservation">
        INSERT INTO reservation (member_id, room_id, check_in, check_out, status, total_amount) VALUES (#{memberId}, #{roomId}, #{checkIn}, #{checkOut}, 'PENDING', #{totalAmount});
    <insert/>

    <!-- 사용자 예약 날짜 변경 -->
    <update id="changeReservationDateByUser" resultType="ResReservation">
        UPDATE reservation SET check_in = #{checkIn}, check_out = #{checkOut}, 
        WHERE reservation_id = #{reservationId} AND member_id = #{memberId};
    <update/>

    <!-- 관리자 예약 날짜 변경 -->
    <update id="changeReservationDate" resultType="ResReservation">
        UPDATE reservation SET check_in = #{checkIn}, check_out = #{checkOut} WHERE reservation_id = #{reservationId}; 
    <update/>

    <!-- 관리자 예약 객실 변경 -->
    <update id="changeReservationRoomById" resultType="ResReservation">
        UPDATE reservation SET room_id = #{roomId} WHERE reservation_id = #{reservationId};
    <update/>

    <!-- 관리자 예약 상태 변경 CANCELLED도 포함-->
    <update id="changeReservationStatusById" resultType="ResReservation">
        UPDATE reservation SET status = #{status} WHERE reservation_id = #{reservationId};
    <update/>

    <!-- 사용자 예약 취소 status==PENDING 일때 -->
   <delete id="deleteReservationById" resultType="ResReservation"> 
        DELETE FROM reservation WHERE reservation_id = #{reservationId} AND status = 'PENDING' 
   <delete/> 

</mapper>